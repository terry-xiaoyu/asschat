# ASSChat
**ASSChat** - A Super Simple Chat protocol for Instant Messaging.

### Why another chat protocol?
在 IM 领域，经常用的两个协议是 `XMPP` 和 `MQTT`。

我很喜欢 MQTT，网络消耗很小，设置了三个 QoS 级别，这一点比起 XMPP 是一个很大的进步。
但是 MQTT 协议里考虑 IoT 的应用场景居多，它本身就是为 IoT 设计的。
所以使用 MQTT 来做 IM 应用的时候，有些地方就不太适应。具体来说，主要有几个方面：
- **离线优先 vs. 在线优先：**

  在 `IM` 应用里，设计时应当 **"offline first"**。IM 应用里，用户的终端不会每时每刻都保持在线，特别是那些移动终端。我们需要首先考虑不在线的场景，因为一个 IM 应用可能在大部分时间里都保持离线状态。当终端离线时，我们需要过推送通知的方式，唤起应用。当应用重新上线之后，应用需要一定的机制，从服务器获取那些它处于离线状态的时间段里，发给他的消息。**我们默认每一条 IM 消息都应该顺利送达，哪怕延时一段时间。**

  而在 `IoT` 应用里，设计的时候其实是 **"online first"**。我们尽量保持设备始终在线，当设备由于某些原因掉线时，持续尝试重连。当设备重新连上服务器后，服务器(视情况)可以把这个设备处于离线状态的时间段里，发给它的消息再次推送给它。另外，设备可以利用 `retained` 消息来间歇性地更新自己的状态，当另一个设备订阅那个表示 "设备的状态" 的主题时，最后一条(最新的)状态信息会立刻推送给它。这个方案里，我们潜在地假设，IoT设备处于离线状态时，没能收到它订阅的消息问题不大；或者在设备处于离线状态时，发给这个设备的消息量不会很多。这符合 IoT 的应用场景。

- **订阅：**

  在 MQTT 协议里，所有的消息传递都是通过 `发布/订阅` 来完成的。QoS 的设计也跟这个模式密切相关。如果一个设备想收到发给自己的消息，需要订阅类似这样的主题 "client1/#"。如果有其他设备向 "client1" 这个主题发布消息，它就能收到。

  在 IM 应用里，我们仅靠 `发布/订阅` 的话，有些地方会不方便：

  假设一个群组里，所有人都订阅了 "group/asschat/#" 这个主题，那么当一个人向 "group/asschat" 发布一条消息的时候，所有人包括他自己也会收到这条消息，这样他就需要辨别出自己发出的这条消息，然后忽略掉。

  假设
